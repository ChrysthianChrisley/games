function ce(e,t,n,r){var i;return r?(i=document.createElement("input"),i.setAttribute("type",e),i.setAttribute("value",n)):(i=document.createElement(e),i.innerHTML=n),i.id=t,i}function setClass(e,t){_(e).setAttribute("class",t)}var _=function(e){return document.getElementById(e)};Array.prototype._forEach=function(e){var t=this.length;if(typeof e!="function")throw new TypeError;var n=arguments[1];for(var r=t;r>0;r--)r in this&&e.call(n,this[r],r,this)},Array.prototype.forEach||(Array.prototype.forEach=function(e){if(this===void 0||this===null)throw new TypeError;var t=Object(this),n=t.length>>>0;if(typeof e!="function")throw new TypeError;var r=arguments[1];for(var i=0;i<n;i++)i in t&&e.call(r,t[i],i,t)}),Object.prototype.addEvent=function(e,t){this.addEventListener?this.addEventListener(e,t,!1):this.attachEvent&&this.attachEvent("on"+e,t)},Object.prototype.clone=function(){var e=this instanceof Array?[]:{};for(i in this){if(i=="clone")continue;this[i]&&typeof this[i]=="object"?e[i]=this[i].clone():e[i]=this[i]}return e};function playAudio(e,t){try{}catch(n){}}function start(e){function r(){var n=[],r=1,s=0;for(i=0;i<e;i++)r+=i;var o=t.pieces.length;for(i=0;i<o;i++)_(t.pieces[i].id).checked&&(s+=1,n.push(t.pieces[i].id.split("-")[1]));if(!s==e)return!1;var u=0,a=!0;for(i=0;i<n.length;i++){if(parseInt(n[i],10)!=u&&parseInt(n[i],10)!=u+1){a=!1;break}u=parseInt(n[i])}return a}function s(){timerInterval=setInterval(function(){_("timer").innerHTML-=1,_("timer").innerHTML==0&&u()},1e3)}function o(){clearInterval(timerInterval),_("lvl").setAttribute("class","slideOut"),_("cur").setAttribute("class","slideOut"),_("ans").setAttribute("class","slideOut"),_("rules").className=="slideIn"?setClass("rules","slideOut"):setClass("getRules","slideOut")}function u(){o(),playAudio("lose"),t.celebrate(!1),_("results").style.display="block",_("results").innerHTML='失败!<br /><sub>Hint: The "Answer" is the highest possible value from the top to the bottom of the pyramid</sub>',_("results").innerHTML+='<br /><button onClick="stopWin();start(lvl)">重新挑战</button>'}function a(){t.playerTotal=0,t.pieces.forEach(function(e,n){_(e.id).checked?(t.playerTotal+=parseInt(e.value),_("icon-"+e.id).setAttribute("class","pieceSelected")):_("icon-"+e.id).setAttribute("class","piece")}),_("cur").innerHTML="当前数值: "+t.playerTotal,t.playerTotal==n&&r()?(o(),playAudio("win"),t.celebrate(!0),_("results").style.display="block",_("results").innerHTML="胜利!",_("results").innerHTML+='<br /><button onClick="stopWin();start(lvl+=1)">下一关</button>'):_("results").innerHTML=""}_("timer").style.display="",_("lvl").innerHTML="第 "+(e-1).toString()+" 关",_("ans").innerHTML="",_("panel").innerHTML="",_("results").innerHTML="",_("results").style.display="none",setClass("lvl","slideIn"),setClass("cur","slideIn"),setClass("ans","slideIn"),setClass("getRules","slideIn"),_("cur").innerHTML="当前数值: 0";var t=new game(e,9),n=t.solution();_("ans").innerHTML="目标数值:  "+n,_("timer").innerHTML=t.currentTime,s(),icon=function(t,n){var r="n";switch(!0){case e<11:r="n";break;case e<16:r="Bn";break;default:r="Cn"}var i='<div class="val '+r+n+'">&nbsp;</div>',s=ce("span","icon-"+t,i);return s.setAttribute("class","piece"),s.addEventListener("click",function(e){_(t).checked=!0,playAudio("click",1),a()}),s};for(i=0;i<e;i++)_("panel").appendChild(ce("div","row-"+i,"")),_("row-"+i).setAttribute("class","row");t.pieces.forEach(function(e,t){e.addEvent("click",function(){a()},!1),e.style.display="none",_("row-"+e.name).appendChild(e),_("row-"+e.name).appendChild(new icon(e.id,e.value))})}var game=function(e,t){this.base=e,this.pieces=[],this.upper=t,this.playerTotal=0,this.dat=new Array(e),this.currentTime=e*5,this.timerRunning=!1,this.init(e,t)};game.prototype={init:function(e,t){for(var n=0;n<this.base;n++){this.dat[n]=new Array(this.base);for(var r=0;r<this.base;r++)this.dat[n][r]=0;for(var r=0;r<=n;r++){this.dat[n][r]=this.retRnd(this.upper);var i=new this.piece(this.dat[n][r],n+"-"+r,n);this.pieces.push(i)}}},retRnd:function(e){var t=Math.floor(Math.random()*(e+1));return t==0?1:t},solve:function(e){return e._forEach(function(n,r,i){n.forEach(function(n,i,s){e[r][i]>e[r][i+1]?e[r-1][i]+=e[r][i]:e[r-1][i]+=e[r][i+1]})}),e[0][0]},solution:function(){return this.copy=this.dat.clone(),this.solve(this.copy)},piece:function(e,t,n){var r=ce("radio",t,e,!0);return r.setAttribute("name",n),r},celebrate:function(e){function s(){var e=_("canvas");t>=e.width?(t=0,n+=r):t+=r,n>=e.height&&(ctx.clearRect(0,0,e.width,e.height),n=0)}function o(){var e=Math.round(16777215*Math.random());return"rgb("+(e>>16)+","+(e>>8&255)+","+(e&255)+")"}var t=-15,n=0,r=15,i=ce("canvas","canvas");document.body.appendChild(i),i.getContext&&(ctx=i.getContext("2d"),this.gridSize=15,myInterval=setInterval(s,15))}};var lvl=2,stopWin=function(){var e=_("canvas"),t=e.getContext("2d");clearInterval(myInterval),t.clearRect(0,0,e.width,e.height),document.body.removeChild(_("canvas"));try{_("win").pause(),_("win").currentTime=0,_("lose").pause(),_("lose").currentTime=0}catch(n){}};(function(){_("hideRules").onclick=function(){setClass("rules","slideOut"),setClass("getRules","slideIn")},_("getRules").onclick=function(){setClass("rules","slideIn"),setClass("getRules","slideOut")}})(),document.addEventListener("click",function(e){e.preventDefault()},!1),document.addEventListener("touchmove",function(e){e.preventDefault()},!1),document.addEventListener("touchend",function(e){e.preventDefault()},!1);